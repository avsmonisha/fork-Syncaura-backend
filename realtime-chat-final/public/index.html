<!DOCTYPE html>
<html>
<head>
    <title>Realtime Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="chat-container">
    <div class="header">Realtime Chat</div>

    <div class="chat-body">
        <div class="users">
            <b>Online</b>
            <ul id="usersList"></ul>
        </div>

        <div class="messages" id="messages"></div>
    </div>

    <div class="input-area">
        <input id="msgInput" placeholder="Type a message..." />
        <button id="sendBtn">âž¤</button>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

let username = "";
while (!username) {
    username = prompt("Enter your name");
}

socket.emit("join", username);

socket.on("room-full", () => {
    alert("Chat room is full (only 5 members allowed)");
    location.reload();
});

const messages = document.getElementById("messages");
const input = document.getElementById("msgInput");
const sendBtn = document.getElementById("sendBtn");
const usersList = document.getElementById("usersList");

sendBtn.onclick = sendMessage;
input.addEventListener("keypress", e => {
    if (e.key === "Enter") sendMessage();
});

function sendMessage() {
    if (input.value.trim() === "") return;
    socket.emit("chat-message", input.value);
    input.value = "";
}

socket.on("chat-message", data => {
    const div = document.createElement("div");
    div.className = data.id === socket.id ? "msg my" : "msg other";
    div.innerHTML = `<b>${data.user}</b><br>${data.text}`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
});

socket.on("users-list", users => {
    usersList.innerHTML = "";
    users.forEach(u => {
        const li = document.createElement("li");
        li.textContent = u;
        usersList.appendChild(li);
    });
});

socket.on("users-count", count => {
    document.querySelector(".header").innerText =
        `Realtime Chat (${count}/5 online)`;
});
</script>

</body>
</html>
