<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth API Tester</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .api-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .api-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .method {
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.9rem;
            text-transform: uppercase;
        }
        
        .method.post { background: #10b981; color: white; }
        .method.get { background: #3b82f6; color: white; }
        
        .endpoint {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #555;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        input, select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .tokens {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e9ecef;
        }
        
        .token-display {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .token-input {
            flex: 1;
            background: white;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .copy-btn {
            background: #6c757d;
            width: auto;
            padding: 10px 15px;
            font-size: 0.9rem;
        }
        
        .response {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .response.success { border-left: 4px solid #10b981; }
        .response.error { border-left: 4px solid #ef4444; }
        
        .note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            color: #856404;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üîê Auth API Tester</h1>
        <p class="subtitle">Test your Express + MongoDB authentication endpoints</p>
    </header>

    <div class="container">
        <!-- Registration Form -->
        <div class="api-card">
            <div class="card-header">
                <span class="method post">POST</span>
                <span class="endpoint">/api/auth/register</span>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="regName">Name</label>
                    <input type="text" id="regName" placeholder="Enter full name" value="John Doe">
                </div>
                <div class="form-group">
                    <label for="regEmail">Email</label>
                    <input type="email" id="regEmail" placeholder="Enter email" value="john@example.com">
                </div>
                <div class="form-group">
                    <label for="regPassword">Password</label>
                    <input type="password" id="regPassword" placeholder="Enter password" value="password123">
                </div>
                <div class="form-group">
                    <label for="regRole">Role</label>
                    <select id="regRole">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                        <option value="manager">Manager</option>
                    </select>
                </div>
                <button type="submit">Register User</button>
            </form>
            <div id="registerResponse" class="response"></div>
        </div>

        <!-- Login Form -->
        <div class="api-card">
            <div class="card-header">
                <span class="method post">POST</span>
                <span class="endpoint">/api/auth/login</span>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="Enter email" value="john@example.com">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter password" value="password123">
                </div>
                <button type="submit">Login</button>
            </form>
            <div id="loginResponse" class="response"></div>
        </div>

        <!-- Token Section -->
        <div class="tokens">
            <h3>üîë Tokens (Will auto-fill after login)</h3>
            <div class="token-display">
                <input type="text" id="accessToken" class="token-input" placeholder="Access Token will appear here" readonly>
                <button type="button" class="copy-btn" onclick="copyToken('accessToken')">Copy</button>
            </div>
            <div class="token-display">
                <input type="text" id="refreshToken" class="token-input" placeholder="Refresh Token will appear here" readonly>
                <button type="button" class="copy-btn" onclick="copyToken('refreshToken')">Copy</button>
            </div>
        </div>

        <!-- Refresh Token -->
        <div class="api-card">
            <div class="card-header">
                <span class="method post">POST</span>
                <span class="endpoint">/api/auth/refresh</span>
            </div>
            <form id="refreshForm">
                <div class="form-group">
                    <label for="refreshTokenInput">Refresh Token</label>
                    <input type="text" id="refreshTokenInput" placeholder="Paste refresh token here">
                </div>
                <button type="submit">Refresh Access Token</button>
            </form>
            <div id="refreshResponse" class="response"></div>
        </div>

        <!-- Forgot Password -->
        <div class="api-card">
            <div class="card-header">
                <span class="method post">POST</span>
                <span class="endpoint">/api/auth/forgot-password</span>
            </div>
            <form id="forgotPasswordForm">
                <div class="form-group">
                    <label for="forgotEmail">Email</label>
                    <input type="email" id="forgotEmail" placeholder="Enter email" value="john@example.com">
                </div>
                <button type="submit">Send Reset Email</button>
            </form>
            <div id="forgotResponse" class="response"></div>
        </div>

        <!-- Request Password OTP -->
        <div class="api-card">
            <div class="card-header">
                <span class="method post">POST</span>
                <span class="endpoint">/api/auth/request-password-otp</span>
            </div>
            <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">Requires authentication. Check console for OTP.</p>
            <form id="requestOtpForm">
                <button type="submit" id="requestOtpBtn">Request OTP (Check Console)</button>
            </form>
            <div id="requestOtpResponse" class="response"></div>
        </div>

        <!-- Change Password with OTP -->
        <div class="api-card">
            <div class="card-header">
                <span class="method post">POST</span>
                <span class="endpoint">/api/auth/change-password-otp</span>
            </div>
            <form id="changePasswordOtpForm">
                <div class="form-group">
                    <label for="otp">OTP (6-digit from console)</label>
                    <input type="text" id="otp" placeholder="Enter OTP" maxlength="6">
                </div>
                <div class="form-group">
                    <label for="newPasswordOtp">New Password</label>
                    <input type="password" id="newPasswordOtp" placeholder="Enter new password" value="newpassword123">
                </div>
                <button type="submit">Change Password with OTP</button>
            </form>
            <div id="changePasswordOtpResponse" class="response"></div>
        </div>

        <!-- Change Password -->
        <div class="api-card">
            <div class="card-header">
                <span class="method post">POST</span>
                <span class="endpoint">/api/auth/change-password</span>
            </div>
            <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">Requires authentication.</p>
            <form id="changePasswordForm">
                <div class="form-group">
                    <label for="currentPassword">Current Password</label>
                    <input type="password" id="currentPassword" placeholder="Enter current password" value="password123">
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <input type="password" id="newPassword" placeholder="Enter new password" value="newpassword123">
                </div>
                <button type="submit">Change Password</button>
            </form>
            <div id="changePasswordResponse" class="response"></div>
        </div>

        <!-- Admin Endpoint -->
        <div class="api-card">
            <div class="card-header">
                <span class="method get">GET</span>
                <span class="endpoint">/api/auth/admin</span>
            </div>
            <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">Requires admin role authentication.</p>
            <form id="adminForm">
                <button type="submit">Test Admin Endpoint</button>
            </form>
            <div id="adminResponse" class="response"></div>
        </div>
    </div>

    <div class="note">
        <strong>Note:</strong> 
        <ul style="margin-top: 10px; padding-left: 20px;">
            <li>Make sure your backend server is running on http://localhost:4000</li>
            <li>Access and refresh tokens will be saved automatically after login</li>
            <li>For protected endpoints, the access token will be sent automatically</li>
            <li>Check your server console for OTP codes</li>
            <li>Reset password token will be logged to console (simulates email)</li>
        </ul>
    </div>

    <footer>
        <p>Auth API Testing Interface | Backend: Express + MongoDB | Frontend: HTML/CSS/JS</p>
    </footer>

    <script>
        const API_BASE_URL = 'http://localhost:4000/api';
        let accessToken = localStorage.getItem('accessToken') || '';
        let refreshToken = localStorage.getItem('refreshToken') || '';

        // Initialize token inputs
        document.getElementById('accessToken').value = accessToken;
        document.getElementById('refreshToken').value = refreshToken;
        document.getElementById('refreshTokenInput').value = refreshToken;

        // Save tokens to localStorage
        function saveTokens(access, refresh) {
            accessToken = access;
            refreshToken = refresh;
            localStorage.setItem('accessToken', access);
            localStorage.setItem('refreshToken', refresh);
            document.getElementById('accessToken').value = access;
            document.getElementById('refreshToken').value = refresh;
            document.getElementById('refreshTokenInput').value = refresh;
        }

        // Clear tokens
        function clearTokens() {
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            accessToken = '';
            refreshToken = '';
            document.getElementById('accessToken').value = '';
            document.getElementById('refreshToken').value = '';
            document.getElementById('refreshTokenInput').value = '';
        }

        // Copy token to clipboard
        function copyToken(tokenId) {
            const token = document.getElementById(tokenId).value;
            if (token) {
                navigator.clipboard.writeText(token).then(() => {
                    alert('Token copied to clipboard!');
                });
            } else {
                alert('No token to copy!');
            }
        }

        // Display response
        function displayResponse(elementId, data, isError = false) {
            const responseDiv = document.getElementById(elementId);
            responseDiv.textContent = JSON.stringify(data, null, 2);
            responseDiv.className = `response ${isError ? 'error' : 'success'}`;
        }

        // Make API request
        async function makeRequest(endpoint, method, body = null, requiresAuth = false) {
            const url = `${API_BASE_URL}${endpoint}`;
            const headers = {
                'Content-Type': 'application/json'
            };

            if (requiresAuth && accessToken) {
                headers['Authorization'] = `Bearer ${accessToken}`;
            }

            try {
                const options = {
                    method,
                    headers
                };

                if (body && method !== 'GET') {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(url, options);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || `HTTP ${response.status}`);
                }

                return data;
            } catch (error) {
                throw error;
            }
        }

        // Register Form
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const userData = {
                name: document.getElementById('regName').value,
                email: document.getElementById('regEmail').value,
                password: document.getElementById('regPassword').value,
                role: document.getElementById('regRole').value
            };

            try {
                const data = await makeRequest('/auth/register', 'POST', userData);
                displayResponse('registerResponse', data);
            } catch (error) {
                displayResponse('registerResponse', { error: error.message }, true);
            }
        });

        // Login Form
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const credentials = {
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPassword').value
            };

            try {
                const data = await makeRequest('/auth/login', 'POST', credentials);
                saveTokens(data.accessToken, data.refreshToken);
                displayResponse('loginResponse', { message: 'Login successful! Tokens saved.', user: data.user });
            } catch (error) {
                displayResponse('loginResponse', { error: error.message }, true);
            }
        });

        // Refresh Token
        document.getElementById('refreshForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const token = document.getElementById('refreshTokenInput').value;

            try {
                const data = await makeRequest('/auth/refresh', 'POST', { refreshToken: token });
                saveTokens(data.accessToken, data.refreshToken);
                displayResponse('refreshResponse', { message: 'Tokens refreshed!', tokens: data });
            } catch (error) {
                displayResponse('refreshResponse', { error: error.message }, true);
            }
        });

        // Forgot Password
        document.getElementById('forgotPasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('forgotEmail').value;

            try {
                const data = await makeRequest('/auth/forgot-password', 'POST', { email });
                console.log('Reset Token (simulated email):', data.resetToken || 'Check server logs');
                displayResponse('forgotResponse', { 
                    message: 'Reset email sent (check server console for token)',
                    note: 'In production, this would be sent via email'
                });
            } catch (error) {
                displayResponse('forgotResponse', { error: error.message }, true);
            }
        });

        // Request OTP
        document.getElementById('requestOtpForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const data = await makeRequest('/auth/request-password-otp', 'POST', null, true);
                console.log('OTP for password change:', data.otp || 'Check server logs');
                displayResponse('requestOtpResponse', { 
                    message: 'OTP generated (check server console)',
                    note: 'Use this OTP to change password'
                });
            } catch (error) {
                displayResponse('requestOtpResponse', { error: error.message }, true);
            }
        });

        // Change Password with OTP
        document.getElementById('changePasswordOtpForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const otpData = {
                otp: document.getElementById('otp').value,
                newPassword: document.getElementById('newPasswordOtp').value
            };

            try {
                const data = await makeRequest('/auth/change-password-otp', 'POST', otpData, true);
                displayResponse('changePasswordOtpResponse', data);
            } catch (error) {
                displayResponse('changePasswordOtpResponse', { error: error.message }, true);
            }
        });

        // Change Password
        document.getElementById('changePasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const passwordData = {
                currentPassword: document.getElementById('currentPassword').value,
                newPassword: document.getElementById('newPassword').value
            };

            try {
                const data = await makeRequest('/auth/change-password', 'POST', passwordData, true);
                displayResponse('changePasswordResponse', data);
            } catch (error) {
                displayResponse('changePasswordResponse', { error: error.message }, true);
            }
        });

        // Admin Endpoint
        document.getElementById('adminForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const data = await makeRequest('/auth/admin', 'GET', null, true);
                displayResponse('adminResponse', data);
            } catch (error) {
                displayResponse('adminResponse', { error: error.message }, true);
            }
        });

        // Logout button (optional)
        const logoutBtn = document.createElement('button');
        logoutBtn.textContent = 'Logout (Clear Tokens)';
        logoutBtn.style.background = '#ef4444';
        logoutBtn.style.marginTop = '10px';
        logoutBtn.onclick = clearTokens;
        document.querySelector('.tokens').appendChild(logoutBtn);
    </script>
</body>
</html>